(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2046:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var a=r(5155),s=r(2115),l=r(1238),n=r(4514),i=r(4246);let o=()=>(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M5 12h14"}),(0,a.jsx)("path",{d:"M12 5v14"})]}),c=()=>(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}),(0,a.jsx)("circle",{cx:"9",cy:"9",r:"2"}),(0,a.jsx)("path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"})]}),d=()=>(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"m22 2-7 20-4-9-9-4Z"}),(0,a.jsx)("path",{d:"M22 2 11 13"})]}),u=()=>(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,a.jsx)("polyline",{points:"7 10 12 15 17 10"}),(0,a.jsx)("line",{x1:"12",x2:"12",y1:"15",y2:"3"})]});function x(){var e;let[t,r]=(0,s.useState)(""),[x,h]=(0,s.useState)("gemini-2.5-pro"),[m,g]=(0,s.useState)([]),[p,f]=(0,s.useState)(""),[b,y]=(0,s.useState)(!1),[j,v]=(0,s.useState)(null),[w,N]=(0,s.useState)(null),[k,S]=(0,s.useState)(null),C=(0,s.useRef)(null),I=(0,s.useRef)(null),E=(0,s.useRef)("");(0,s.useEffect)(()=>{var e;null==(e=C.current)||e.scrollIntoView({behavior:"smooth"})},[m]),(0,s.useEffect)(()=>{let e=localStorage.getItem("gemini-api-key"),t=localStorage.getItem("gemini-model");e&&(r(e),E.current=e),t&&h(t)},[]);let P=()=>{v(null),N(null),S(null),I.current&&(I.current.value="")},_=async()=>{if(!p.trim()&&!w||b)return;if(!t)return void alert("Please set your API Key in the right sidebar first.");y(!0);let e=[];p.trim()&&e.push({text:p}),w&&k&&e.push({inlineData:{mimeType:k,data:w}});let r={role:"user",parts:e},a={contents:[...m,r]};g(e=>[...e,r,{role:"model",parts:[{text:""}]}]),f(""),P();let s=x.includes("image");try{var l,n,i,o,c,d,u;if(s){let e="https://taoqin.baby/v1/chat/completions/".concat(x,":generateContent?key=").concat(t),r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok)throw Error("API Error: ".concat(r.status," ").concat(r.statusText));let s=await r.json();console.log("API Response:",JSON.stringify(s,null,2));let d=null==(i=s.candidates)||null==(n=i[0])||null==(l=n.content)?void 0:l.parts;if(d)g(e=>e.map((t,r)=>r===e.length-1?{...t,parts:d}:t));else{let e=(null==(c=s.candidates)||null==(o=c[0])?void 0:o.finishReason)||"No content returned.",t="Sorry, I couldn't generate a response. Reason: ".concat(e);g(e=>e.map((r,a)=>a===e.length-1?{...r,parts:[{text:t}]}:r))}}else{let e="https://taoqin.baby/v1/chat/completions/".concat(x,":streamGenerateContent?alt=sse&key=").concat(t),r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok)throw Error("API Error: ".concat(r.status," ").concat(r.statusText));if(!r.body)throw Error("Response body is null");let s=r.body.getReader(),l=new TextDecoder,n="";for(;;){let e,{done:t,value:r}=await s.read();if(t)break;for(n+=l.decode(r,{stream:!0});-1!==(e=n.indexOf("\n"));){let t=n.substring(0,e);if(n=n.substring(e+1),t.startsWith("data: "))try{let e=t.substring(6),r=null==(u=JSON.parse(e).candidates[0])||null==(d=u.content)?void 0:d.parts[0];(null==r?void 0:r.text)&&g(e=>e.map((t,a)=>{if(a===e.length-1){let e=[...t.parts],a=e[e.length-1];return a&&void 0!==a.text?a.text+=r.text:e.push({text:r.text}),{...t,parts:e}}return t}))}catch(e){}}}}}catch(t){let e=t instanceof Error?t.message:String(t);console.error(e),g(t=>t.map((r,a)=>a===t.length-1?{...r,parts:[{text:"An error occurred: ".concat(e)}]}:r))}finally{y(!1)}};return(0,a.jsxs)("div",{className:"flex flex-1 font-sans text-gray-900 bg-white",children:[(0,a.jsxs)("aside",{className:"w-64 flex flex-col items-start p-4 bg-gray-50 border-r border-gray-200 space-y-2",children:[(0,a.jsxs)("button",{onClick:()=>{g([]),P()},className:"flex items-center justify-start w-full px-4 rounded-lg hover:bg-gray-200",children:[(0,a.jsx)(o,{}),(0,a.jsx)("span",{className:"ml-3 font-medium",children:"New Chat"})]}),(0,a.jsxs)("button",{onClick:()=>{if(0===m.length)return void alert("No chat history to export.");let e=m.map(e=>{let t=e.parts.map(e=>e.text?e.text:e.inlineData?"[Image Content: ".concat(e.inlineData.mimeType,"]"):"").join("\n");return{Timestamp:new Date().toISOString(),Role:e.role,Content:t}}),t=i.Wp.json_to_sheet(e),r=i.Wp.book_new();i.Wp.book_append_sheet(r,t,"ChatHistory"),i._h(r,"chat-history.xlsx")},className:"flex items-center justify-start w-full px-4 rounded-lg hover:bg-gray-200",children:[(0,a.jsx)(u,{}),(0,a.jsx)("span",{className:"ml-3 font-medium",children:"Export Excel"})]})]}),(0,a.jsxs)("main",{className:"flex-1 flex flex-col",children:[(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4 md:p-6",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto space-y-6",children:[0===m.length&&!b&&(0,a.jsx)("div",{className:"text-center text-gray-500",children:"Start a conversation..."}),m.map((e,t)=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,a.jsx)("div",{className:"max-w-lg lg:max-w-2xl px-4 py-3 rounded-xl shadow ".concat("user"===e.role?"bg-blue-500 text-white":"bg-gray-100 text-gray-800"),children:(0,a.jsx)("div",{className:"prose prose-sm max-w-none prose-pre:bg-gray-800 prose-pre:text-gray-100 ${msg.role === 'user' ? 'prose-invert' : ''}",children:e.parts.map((e,t)=>{if(e.inlineData){let r="data:".concat(e.inlineData.mimeType,";base64,").concat(e.inlineData.data);return(0,a.jsx)("img",{src:r,alt:"Generated content",className:"rounded-md"},t)}return e.text?(0,a.jsx)(l.oz,{remarkPlugins:[n.A],children:e.text},t):null})})})},t)),b&&(null==(e=m[m.length-1])?void 0:e.parts.every(e=>!e.text&&!e.inlineData))&&(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsx)("div",{className:"px-4 py-3 rounded-xl shadow bg-gray-100 animate-pulse",children:(0,a.jsx)("p",{className:"text-gray-600",children:"Thinking..."})})}),(0,a.jsx)("div",{ref:C})]})}),(0,a.jsx)("div",{className:"px-4 pt-4 pb-2 md:px-6 md:pt-6 md:pb-2 border-t border-gray-200",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto",children:[j&&(0,a.jsxs)("div",{className:"mb-4 relative w-32",children:[(0,a.jsx)("img",{src:j,alt:"Image preview",className:"rounded-lg"}),(0,a.jsx)("button",{onClick:P,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold",children:"X"})]}),(0,a.jsxs)("div",{className:"flex items-center p-2 rounded-lg border border-gray-300 focus-within:border-blue-500 bg-gray-50",children:[(0,a.jsx)("button",{onClick:()=>{var e;return null==(e=I.current)?void 0:e.click()},className:"p-2 text-gray-500 hover:text-gray-800",children:(0,a.jsx)(c,{})}),(0,a.jsx)("input",{type:"file",ref:I,onChange:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];if(!r)return;if(!r.type.startsWith("image/"))return void alert("Please upload a valid image file.");S(r.type);let a=new FileReader;a.onloadend=()=>{let e=a.result;v(e),N(e.split(",")[1])},a.readAsDataURL(r)},accept:"image/*",className:"hidden"}),(0,a.jsx)("textarea",{placeholder:"Type a message, or upload an image to ask about it...",value:p,onChange:e=>f(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),_())},className:"flex-1 p-2 bg-transparent focus:outline-none resize-none h-auto max-h-48",rows:1,disabled:b}),(0,a.jsx)("button",{onClick:_,disabled:b,className:"p-2 text-gray-500 disabled:text-gray-300 hover:text-blue-600",children:(0,a.jsx)(d,{})})]})]})})]}),(0,a.jsxs)("aside",{className:"w-80 p-4 bg-gray-50 border-l border-gray-200 flex flex-col space-y-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Settings"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"model-select",className:"block text-sm font-medium text-gray-700 mb-1",children:"Model"}),(0,a.jsxs)("select",{id:"model-select",value:x,onChange:e=>{var t;h(t=e.target.value),localStorage.setItem("gemini-model",t)},className:"w-full p-2 bg-white border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:b,children:[(0,a.jsx)("option",{value:"gemini-2.5-pro",children:"Gemini 2.5 Pro"}),(0,a.jsx)("option",{value:"gemini-2.5-flash",children:"Gemini 2.5 Flash"}),(0,a.jsx)("option",{value:"gemini-2.5-flash-image-preview",children:"Gemini 2.5 Image Preview"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"api-key-input",className:"block text-sm font-medium text-gray-700 mb-1",children:"API Key"}),(0,a.jsx)("input",{id:"api-key-input",type:"password",placeholder:"Your Google AI API Key",defaultValue:t,onChange:e=>E.current=e.target.value,className:"w-full p-2 border border-gray-300 rounded-md mb-2 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("button",{onClick:()=>{if(!E.current.trim())return void alert("API Key cannot be empty.");r(E.current),localStorage.setItem("gemini-api-key",E.current),alert("API Key saved.")},className:"w-full px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-md font-semibold",children:"Save Key"})]})]})]})}var h=r(7677);function m(){let[e,t]=(0,s.useState)([]),[r,n]=(0,s.useState)(null),[i,o]=(0,s.useState)(""),[c,d]=(0,s.useState)(!0),[u,x]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/guide-config.json"),r=await e.json();if(t(r),r.length>0){let e=r[0];e.file?n(e.file):e.children&&e.children.length>0&&n(e.children[0].file)}}catch(e){console.error("Failed to fetch config:",e)}finally{d(!1)}})()},[]),(0,s.useEffect)(()=>{(async()=>{if(r){x(!0);try{let e=await fetch("/".concat(r)),t=await e.text();o(t)}catch(e){console.error("Failed to fetch content:",e),o("Error loading content.")}finally{x(!1)}}})()},[r]);let m=e=>(0,a.jsx)("ul",{children:e.map((e,t)=>(0,a.jsxs)("li",{children:[e.file?(0,a.jsxs)("button",{onClick:()=>n(e.file),className:"block w-full text-left p-2 rounded-md ".concat(r===e.file?"bg-blue-100 text-blue-700":"hover:bg-gray-100 text-gray-700"),children:[e.title_zh," / ",e.title_en]}):(0,a.jsxs)("span",{className:"block p-2 font-semibold text-gray-800",children:[e.title_zh," / ",e.title_en]}),e.children&&(0,a.jsx)("ul",{className:"pl-4",children:m(e.children)})]},t))});return(0,a.jsxs)("div",{className:"flex h-full bg-white",children:[(0,a.jsxs)("aside",{className:"w-64 p-4 border-r border-gray-200 overflow-y-auto",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"练功指南目录"}),c?(0,a.jsx)("div",{className:"text-gray-500",children:"Loading menu..."}):m(e)]}),(0,a.jsx)("main",{className:"flex-1 p-8 overflow-y-auto",children:u?(0,a.jsx)("div",{className:"text-center text-gray-500",children:"Loading content..."}):(0,a.jsxs)("div",{className:"prose max-w-none",children:[" ",(0,a.jsx)(l.oz,{rehypePlugins:[h.A],children:i})]})})]})}function g(){let[e,t]=(0,s.useState)("chat");return(0,a.jsxs)("main",{className:"flex flex-col h-screen",children:[(0,a.jsx)("div",{className:"bg-gray-100 border-b border-gray-200",children:(0,a.jsx)("nav",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"-mb-px flex space-x-8",children:[(0,a.jsx)("button",{onClick:()=>t("chat"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("chat"===e?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"聊天 (Chat)"}),(0,a.jsx)("button",{onClick:()=>t("guide"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("guide"===e?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"练功场 (Guide)"})]})})}),(0,a.jsx)("div",{className:"flex flex-col flex-1 h-full",children:(()=>{switch(e){case"chat":default:return(0,a.jsx)(x,{});case"guide":return(0,a.jsx)(m,{})}})()})]})}},2307:(e,t,r)=>{Promise.resolve().then(r.bind(r,2046))},2383:()=>{},3686:()=>{}},e=>{e.O(0,[524,606,441,255,358],()=>e(e.s=2307)),_N_E=e.O()}]);